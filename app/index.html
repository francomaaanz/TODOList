<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" ng-app="myApp" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> 
<html lang="en" ng-app="todoApp" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Lista de quehaceres</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="bower_components/html5-boilerplate/dist/css/normalize.css">
        <link rel="stylesheet" href="bower_components/html5-boilerplate/dist/css/main.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script src="bower_components/html5-boilerplate/dist/js/vendor/modernizr-2.8.3.min.js"></script>
    </head>        
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div ng-view></div>
        <!-- In production use:
        <script src="//ajax.googleapis.com/ajax/libs/angularjs/x.x.x/angular.min.js"></script>
        -->
        <div class="container" ng-controller="ToDoCtrl">
            <div class="page-header" >
                <h1 style="font-size: 33px;">{{todo.user}} ¿Qué tenes que hacer? 
                    <span class="label label-primary" ng-hide="incompleteCount() == 0" ng-class="warningLevel()">
                        {{incompleteCount()}}
                    </span>
                </h1>
            </div>
            <div class="panel">
                <div class="input-group">
                    <input class="form-control" ng-model="agregarItem">
                    <span class="input-group-btn">
                        <button class="btn btn-default" ng-click="addNewItem(agregarItem)">Agregar</button>
                    </span>
                </div>
                <table class="table table-striped" style="border: 1px solid #ddd; margin-top: 25px; padding: 10px 10px;">
                    <thead>
                        <tr>
                            <th class="text-center">Descripcion</th>
                            <th class="text-center">Hecho</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="item in todo.items| checkedItems: showComplete | orderBy: 'action'">
                            <td class="text-center">{{item.action}}</td>
                            <td class="text-center"><input type="checkbox" ng-model="item.done" /></td>
                        </tr>
                    </tbody>
                </table>
                <div class="checkbox-inline" style="margin-top: 20px;">
                    <label><input type="checkbox" ng-model="showComplete" />Mostrar Actividades terminadas</label>
                </div>
            </div>
        </div>
        <script src="angular.js"></script>
        <script>
                                //creo un objeto JSON llamado model
                                var model = {
                                    user: "Franco"
                                    
                                };
                                //Creo app, debe hacer match con el ng-app=""
                                var todoApp = angular.module('todoApp', []);
                                
                                todoApp.run(function ($http) {
                                    $http.get("todo.json").success(function (data) {
                                        model.items = data;
                                    });
                                });

                                todoApp.filter("checkedItems", function () {
                                    return function (items, showComplete) {
                                        var resultArray = [];
                                        angular.forEach(items, function (item) {
                                            if (item.done === false || showComplete === true) {
                                                resultArray.push(item);
                                            }
                                        });
                                        return resultArray;
                                    }
                                });

                                //Creo controlador de la app
                                todoApp.controller("ToDoCtrl", function ($scope) {
                                    //al Objeto JSON creado llamado model se lo asigno a todo                    
                                    $scope.todo = model;
                                    $scope.incompleteCount = function () {
                                        var count = 0;
                                        angular.forEach($scope.todo.items, function (item) {
                                            if (!item.done) {
                                                count++;
                                            }
                                        });
                                        return count;
                                    }//termina incompleteCount
                                    $scope.warningLevel = function () {
                                        return $scope.incompleteCount() < 3 ? "label-sucess" : "label-warning";
                                    }//termina warining
                                    $scope.addNewItem = function (agregarItem) {
                                        return $scope.todo.items.push({action: agregarItem, done: false});
                                    }
                                });
        </script>
    </body>
</html>
